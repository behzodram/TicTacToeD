<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tic-Tac-To o'yini</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="container">
  <div id="playerText">Player 1</div>
  <div class="row">
    <button class="btn" data-index="0"></button>
    <button class="btn" data-index="1"></button>
    <button class="btn" data-index="2"></button>
  </div>
  <div class="row">
    <button class="btn" data-index="3"></button>
    <button class="btn" data-index="4"></button>
    <button class="btn" data-index="5"></button>
  </div>
  <div class="row">
    <button class="btn" data-index="6"></button>
    <button class="btn" data-index="7"></button>
    <button class="btn" data-index="8"></button>
  </div>
</div>

<!-- Tabriklash oynasi -->
<div id="celebration">
  <h2 id="score-msg"></h2>
  <button id="play-again" onclick="ResetGame()">Play Again</button>
</div>

<!-- Confetti uchun canvas -->
<canvas id="confetti-canvas"></canvas>

<!-- Ovozlar -->
<audio id="winSound" preload="auto" src="https://www.dropbox.com/scl/fi/7h9ob4cd3iknipeqhgf3u/mixkit-achievement-bell-600.wav?rlkey=zyq1auz9urk3vnx70g8x9sp4c&st=iva17nk3&raw=1"></audio>
<audio id="clickSound" preload="auto" src="https://www.dropbox.com/scl/fi/imtc8kle7z9zv8n5s1u97/select-sound-121244.mp3?rlkey=xr90r1doaem833fwntb0po2ms&st=kt25o6un&raw=1"></audio>
<audio id="celebrateSound" preload="auto" src="https://www.dropbox.com/scl/fi/pl2xdyazb467pswzb08tl/mixkit-video-game-treasure-2066.wav?rlkey=shpb4dmiq85u34ipvy4rlv5i4&st=x2dew0lo&raw=1"></audio>

<!-- Confetti JS -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
  /* Sizning asl script kodi shu yerda o'zgarmagan holda qoldiriladi */
  const btns = Array.from(document.querySelectorAll('.btn'));
  const txtPlayer = document.getElementById('playerText');
  const celebration = document.getElementById('celebration');
  const scoreMsg = document.getElementById('score-msg');
  const playAgainBtn = document.getElementById('play-again');
  const confettiCanvas = document.getElementById('confetti-canvas');
  const clickSound = document.getElementById('clickSound');
  const winSound = document.getElementById('winSound');
  const celebrateSound = document.getElementById('celebrateSound');

  let round = 1;
  let player = 1;
  let touch = false;

  function playClickSound(){
    clickSound.currentTime = 0;
    clickSound.play().catch(() => {});
  }

  function SetButton(btn, text) {
    btn.style.transform = 'rotate(360deg)';
    setTimeout(() => {
      btn.textContent = text;
      btn.style.transform = '';
    }, 100);
    btn.dataset.text = text;
  }

  function launchConfetti() {
    confetti({
      particleCount: 150,
      spread: 90,
      origin: { y: 0.6 },
      disableForReducedMotion: true
    });

    const duration = 3000;
    const end = Date.now() + duration;

    (function frame() {
      confetti({
        particleCount: 3,
        angle: 60,
        spread: 55,
        origin: { x: 0 }
      });
      confetti({
        particleCount: 3,
        angle: 120,
        spread: 55,
        origin: { x: 1 }
      });

      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    })();
  }

  function CheckWin() {
    touch = false;
    const winRows = ["012", "345", "678", "036", "147", "258", "048", "642"];
    for (const rowIndex of winRows) {
      let row = "";
      for (let j = 0; j < 3; j++) {
        row += btns[+rowIndex[j]].dataset.text || '';
      }
      if (row === 'XXX' || row === 'OOO') {
        return EndGame(player);
      }
    }

    if (round > 9) return EndGame(0); // Durang
    txtPlayer.textContent = "Player " + player;
  }

  function EndGame(winner) {
    btns.forEach(btn => btn.disabled = true);

    if (winner) {
      scoreMsg.textContent = `Player ${winner} won! ðŸŽ‰`;
      celebrateSound.currentTime = 0;
      celebrateSound.play().catch(() => {});
      launchConfetti();
    } else {
      scoreMsg.textContent = `It's a draw!`;
      winSound.currentTime = 0;
      winSound.play().catch(() => {});
    }
    celebration.style.display = 'flex';
  }

  function ResetGame() {
    celebration.style.display = 'none';

    btns.forEach((btn, i) => {
      btn.disabled = false;
      SetButton(btn, '');
    });

    round = 1;
    player = 1;
    touch = false;
    txtPlayer.textContent = "Player 1";
  }

  function btn_OnTouch(e) {
    if (touch) return;
    touch = true;

    playClickSound();

    let btn = e.currentTarget;
    player = round % 2 === 1 ? 1 : 2;

    if (btn.dataset.text && btn.dataset.text !== '') {
      touch = false;
      return;
    }

    setTimeout(() => {
      btn.style.opacity = player === 1 ? '0.6' : '1';
      setTimeout(() => btn.style.opacity = '1', 300);
    }, 50);

    SetButton(btn, 'XO'[player - 1]);
    round++;
    setTimeout(CheckWin, 220);
  }

  btns.forEach(btn => {
    btn.dataset.text = '';
    btn.addEventListener('click', btn_OnTouch);
  });

  txtPlayer.textContent = "Player 1";
</script>

</body>
</html>
